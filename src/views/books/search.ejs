<h1>Search for books</h1>

<form class="form" action="./books/search" method="get">
  <div class="form-group">
    <label class="form-label" for="subject">
      Choose a subject (required):
    </label>
    <select id="subject" name="subject" class="form-control form-select" required>
      <option value="">-- Select a subject --</option>
      <% subjects.forEach(function(s) { %>
        <option value="<%= s.subject %>"><%= s.subject %></option>
      <% }) %>
    </select>
  </div>

  <div class="form-group">
    <label class="form-label" for="author">Search by Author (optional):</label>
    <input type="text" class="form-control" id="author" name="author" placeholder="Enter an author's first name" autocomplete="off" maxlength="100"/>
  </div>

  <div class="form-group">
    <label class="form-label" for="title">Search by Title (optional):</label>
    <input type="text" class="form-control" id="title" name="title" placeholder="Enter a book title" autocomplete="off" maxlength="200">
  </div>

  <div class="form-group">
    <label class="form-label" for="itemsPerPage">Items per page:</label>
    <select id="itemsPerPage" name="itemsPerPage" class="form-control form-select">
      <option value="3">3</option>
      <option value="5" selected>5</option>
      <option value="10">10</option>
    </select>
  </div>

  <div>
    <button type="submit" class="button">Search</button>
  </div>
</form>

<div id="book-list">
  <% if (typeof books !== 'undefined' && books.length > 0) { %>
      <h2>Books:</h2>
      <% books.forEach(function(book) { %>
        <div class="book">
          <h3 class="book-title"><%= book.title %></h3> 
          <p class="book-info">Author: <%= book.author %></p> 
          <p class="book-info">ISBN: <%= book.isbn %></p>
          <p class="book-info">Subject: <%= book.subject %></p>
          <p class="book-info">Price: <%= book.price %> $</p>
          <% if (typeof userId !== 'undefined' && userId) { %>
            <form class="form cart-form" method="post" action="./cart/add">
              <input type="hidden" name="isbn" value="<%= book.isbn %>"/>
              <input type="number" id="quantity-<%= book.isbn %>" class="quantity-input" name="quantity" min="1" max="100" value="1"/> <button class="button" type="submit">Add to cart</button>
            </form>
          <% } %>
        </div>
      <% }) %>
      <div class="page-navigation">
        <% if (page > 1) { %>
          <a class="button" href="/books/search?<%= new URLSearchParams({...query, page: page - 1
          }).toString() %>">
          Previous page
          </a>
        <% } %>
        <span>Page <%= page %> of <%= totalPages %></span>
        <% if (page < totalPages) { %>
          <a class="button" href="/books/search?<%= new URLSearchParams({...query, page: page + 1
          }).toString() %>">
          Next page
          </a>
        <% } %>
      </div>
  <% } else if (typeof books !== 'undefined') { %>
      <p id="no-books">No books found matching your criteria.</p>
  <% } %>
</div>